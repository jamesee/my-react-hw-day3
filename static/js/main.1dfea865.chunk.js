(this["webpackJsonpreact-marketplace"]=this["webpackJsonpreact-marketplace"]||[]).push([[0],{15:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(9),s=n(3),a=n(2),i=n(1),o="auth",l=localStorage.getItem(o),u=l?{status:"authenticated",accessToken:l}:{status:"anonymous",accessToken:null},d=r.createContext(),j=function(e,t){switch(t.type){case"login":return{accessToken:t.accessToken,status:"authenticated"};case"logout":return{accessToken:null,status:"anonymous"};default:throw new Error("Unsupported event type ".concat(t.type," in authReducer"))}},m=function(e){var t=e.children,n=function(){var e=r.useReducer(j,u),t=Object(a.a)(e,2),n=t[0],c=t[1];return Object(s.a)(Object(s.a)({},n),{},{login:function(e){return c({type:"login",accessToken:e})},logout:function(){return c({type:"logout"})}})}();return Object(i.jsx)(d.Provider,{value:n,children:t})},x=function(){var e=r.useContext(d);if(!e)throw new Error("Your application must be wrapped with AuthProvider");return e},b=function(){var e=r.useContext(d);if(!e)throw new Error("Your application must be wrapped with AuthProvider");return function(t){return function(e,t){return fetch("https://ecomm-service.herokuapp.com/login",{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}).then((function(e){if(e.ok)return e.json();throw new Error(e.statusText)}))}(t.email,t.password).then((function(t){e.login(t.access_token),localStorage.setItem(o,t.access_token)}))}},p=n(5),f=n(4),h=n.n(f),g=function(e){var t=e.type,n=void 0===t?"button":t,r=e.variant,c=e.render,a=Object(p.a)(e,["type","variant","render"]),o=h()("inline-flex justify-center items-center py-2 px-4 border shadow-sm text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500",r&&O[r],a.className);return c?c(Object(s.a)({className:o},a)):Object(i.jsx)("button",Object(s.a)(Object(s.a)({type:n},a),{},{className:o}))},O={primary:"border-transparent text-white bg-pink-600 hover:bg-pink-700",outline:"border-pink-500 text-pink-500 bg-white hover:text-pink-700"},v=0,y=r.createContext();y.displayName="FieldContext";var N=function(e){var t=e.fieldId,n=e.children,c=function(e){var t=r.useState((function(){return e||String(v++)}));return Object(a.a)(t,1)[0]}(t);return Object(i.jsx)(y.Provider,{value:c,children:Object(i.jsx)("div",{className:"space-y-1",children:n})})},w=function(e){var t=r.useContext(y);return Object(i.jsx)("label",Object(s.a)(Object(s.a)({htmlFor:t},e),{},{className:h()("block text-sm font-medium text-gray-900",e.className)}))};function k(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.forEach((function(e){return"function"===typeof e&&e.apply(void 0,n)}))}}var C=r.forwardRef((function(e,t){var n=e.type,c=void 0===n?"text":n,a=e.onChangeValue,o=Object(p.a)(e,["type","onChangeValue"]),l=r.useContext(y);return Object(i.jsx)("input",Object(s.a)(Object(s.a)({type:c},o),{},{id:o.id||l,className:h()("block w-full shadow-sm sm:text-sm focus:ring-pink-500 focus:border-pink-500 border-gray-300 rounded-md",o.className),onChange:k(a&&function(e){return a(e.target.value)},o.onChange),ref:t}))})),T=r.forwardRef((function(e,t){var n=e.label,r=e.id,c=Object(p.a)(e,["label","id"]);return Object(i.jsxs)(N,{fieldId:r,children:[n&&Object(i.jsx)(w,{children:n}),Object(i.jsx)(C,Object(s.a)(Object(s.a)({},c),{},{ref:t}))]})})),E=function(){var e=r.useState(""),t=Object(a.a)(e,2),n=t[0],c=t[1],s=r.useState(""),o=Object(a.a)(s,2),l=o[0],u=o[1],d=r.useState("idle"),j=Object(a.a)(d,2),m=j[0],x=j[1],p=b();return Object(i.jsx)("div",{className:"max-w-md mx-auto m-6 shadow",children:Object(i.jsxs)("form",{onSubmit:function(e){e.preventDefault(),x("loading"),p({email:n,password:l}).catch((function(){return x("error")}))},className:"p-6",children:["error"===m&&Object(i.jsx)("div",{className:"p-2 text-red-800 bg-red-200 rounded-sm",children:"Fail to login."}),Object(i.jsx)("div",{className:"text-3xl mt-4 mb-8 font-extrabold text-center",children:"Login"}),Object(i.jsxs)("div",{className:"space-y-6",children:[Object(i.jsx)(T,{label:"Email",value:n,onChangeValue:c,name:"username",id:"username",autoFocus:!0,required:!0,disabled:"loading"===m}),Object(i.jsx)(T,{label:"Password",value:l,onChangeValue:u,name:"password",id:"password",type:"password",required:!0,disabled:"loading"===m}),Object(i.jsx)(g,{type:"submit",variant:"primary",className:"w-full",disabled:"loading"===m,children:"Login"})]})]})})},S=function(){var e=function(){var e=r.useContext(d);if(!e)throw new Error("Your application must be wrapped with AuthProvider");return function(){e.logout(),localStorage.removeItem(o)}}();return"anonymous"===x().status?null:Object(i.jsx)(g,{variant:"primary",onClick:e,children:"Logout"})},A=(n(15),n(7)),L=function(){return Object(i.jsxs)(g,{variant:"primary",onClick:function(){return alert("Edit btn clicked, populate the form!")},children:[Object(i.jsx)(A.a,{className:"h-4 w-4 mr-1.5"}),"EDIT"]})},D=function(e){var t=e.text,n=e.onClick;return Object(i.jsxs)(g,{variant:"outline",onClick:n,children:[Object(i.jsx)(A.c,{className:"w-4 h-4 mr-1.5"}),t]})},I=function(e){var t=e.children;return Object(i.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:t})},P=function(e){var t=r.useState(!1),n=Object(a.a)(t,2),c=n[0],s=n[1];return Object(i.jsxs)("div",{className:"relative flex flex-col",children:[Object(i.jsxs)("div",{className:"group block w-full rounded-lg bg-gray-100 focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-offset-gray-100 focus-within:ring-pink-500 overflow-hidden",children:[Object(i.jsx)("img",{src:e.imageUrl,alt:"",className:"object-cover pointer-events-none group-hover:opacity-75 h-48 w-full"}),Object(i.jsx)("button",{type:"button",className:"absolute inset-0 focus:outline-none",children:Object(i.jsxs)("span",{className:"sr-only",children:["View details for ",e.title]})})]}),Object(i.jsxs)("div",{className:"flex-1 flex md:flex-col justify-between items-start md:items-stretch gap-3 px-2",children:[Object(i.jsxs)("div",{className:"mt-1 flex-1",children:[Object(i.jsxs)("div",{className:"flex justify-between items-center gap-3",children:[Object(i.jsxs)("div",{children:["RM ",Object(i.jsx)("span",{className:"text-2xl font-bold",children:e.price})]}),e.onlyOne?Object(i.jsx)(I,{children:"Only One"}):Object(i.jsxs)("div",{className:"text-sm text-gray-500",children:[e.availableStock," piece available"]})]}),Object(i.jsx)("p",{className:"block text-sm font-medium text-gray-900 truncate pointer-events-none",children:e.title}),Object(i.jsx)("p",{className:"block text-sm font-medium text-gray-500 pointer-events-none",children:e.description})]}),Object(i.jsx)("div",{className:"flex flex-col md:flex-row gap-3 py-3",children:e.onAddToCart?Object(i.jsxs)(g,{variant:"primary",onClick:e.onAddToCart,children:[Object(i.jsx)(A.b,{className:"h-4 w-4 mr-1.5"})," ADD TO CART"]}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(L,{}),Object(i.jsx)(D,{text:c?"DELETING...":"DELETE",onClick:function(){return s(!c)}})]})})]})]})},U=function(){var e=r.useState(void 0),t=Object(a.a)(e,2),n=t[0],c=t[1],s=r.useState(1),i=Object(a.a)(s,2),o=i[0],l=i[1],u=x(),d=function(e,t){return function(e,t){return fetch("https://ecomm-service.herokuapp.com/marketplace?limit=6&page=".concat(e),{signal:t}).then((function(e){return e.json()}))}(e,t).then((function(e){return c(e)}))};return r.useEffect((function(){var e=new AbortController;return console.log("[DEBUG] useEffect @ use-listing.js: loadListings()"),"authenticated"===u.status&&d(o,e.signal),function(){e.abort()}}),[o,u.status]),{listings:n,page:o,setPage:l,loadListings:d}},B=function(){var e=r.useState([]),t=Object(a.a)(e,2),n=t[0],c=t[1],s=r.useState(0),i=Object(a.a)(s,2),o=i[0],l=i[1],u=x(),d=function(e){return function(e){return fetch("https://ecomm-service.herokuapp.com/marketplace/cart/items",{method:"GET",headers:{Authorization:"Bearer ".concat(e.accessToken),accept:"application/json"}}).then((function(e){if(e.ok)return e.json();throw new Error(e.statusText)})).catch((function(t){console.log(t),e.logout()}))}(e).then((function(e){return c(e)}))};return Object(r.useEffect)((function(){console.log("[DEBUG] useEffect @ use-cartlisting.js: loadCartLisings()"),"authenticated"===u.status&&d(u)}),[u]),Object(r.useEffect)((function(){return console.log("[DEBUG] useEffect @ use-cartlisting.js: calcualteTotal()"),"authenticated"===u.status&&function(e){var t=[];if(console.log("[DEBUG] calculateTotal()"),n.forEach((function(e){t.push(Number(e.listing.price)*Number(e.quantity))})),console.log(t),t.length){var r=t.reduce((function(e,t){return e+t}),0);console.log("[DEBUG] total: ".concat(r)),e(Number(r))}}(l),function(){l()}}),[u,n]),{cartListings:n,loadCartListings:d,addCartItem:function(e,t){(function(e,t){return fetch("https://ecomm-service.herokuapp.com/marketplace/cart/items",{method:"POST",body:JSON.stringify({quantity:1,listingId:e}),headers:{accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t.accessToken)}}).then((function(e){if(e.ok)return e.json();throw new Error(e.statusText)})).catch((function(e){console.log(e),t.logout()}))})(e,t).then((function(){return d(t)}))},removeCartItem:function(e,t){(function(e,t){return fetch("https://ecomm-service.herokuapp.com/marketplace/cart/items/".concat(e),{method:"DELETE",headers:{accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t.accessToken)}}).then((function(e){if(e.ok)return e.json();throw new Error(e.statusText)})).catch((function(e){console.log(e),t.logout()}))})(e,t).then((function(){d(t)}))},cartTotal:o}},F=n(6),G=function(e){var t=e.item,n=e.onClick,r=t.quantity,c=t.listing,s=c.imageUrl,a=c.title,o=c.price;return Object(i.jsxs)("li",{className:"flex px-4 sm:px-6 py-4",children:[Object(i.jsx)("img",{className:"h-10 w-10 rounded-full",src:s,alt:""}),Object(i.jsxs)("div",{className:"flex-1 flex justify-between items-center ml-3",children:[Object(i.jsxs)("div",{children:[Object(i.jsx)("p",{className:"text-sm font-medium text-gray-900",children:a}),Object(i.jsxs)("p",{className:"text-sm text-gray-500",children:["$",o," x ",r]})]}),Object(i.jsxs)("div",{className:"flex items-center gap-2",children:[Object(i.jsxs)("div",{children:["$",(Number(o)*Number(r)).toFixed(2)]}),Object(i.jsx)("button",{className:" text-red-400 p-1 rounded-full hover:bg-gray-50 focus:outline-none focus:bg-gray-50 focus:ring focus:ring-pink-500 focus:ring-opacity-30 transition duration-150 ease-in-out ",onClick:n,children:Object(i.jsx)(F.b,{className:"w-6 h-6"})})]})]})]})},q=function(){return Object(i.jsx)("div",{className:"px-4 sm:px-6 pb-12",children:Object(i.jsx)("div",{className:"pt-6 pb-5",children:Object(i.jsx)("div",{id:"no-cart-item-message",children:Object(i.jsxs)("div",{className:"p-4 text-center",children:[Object(i.jsx)(F.a,{className:"inline-block w-12 h-12 text-gray-300"}),Object(i.jsx)("p",{className:"text-center text-gray-500",children:"There is no item in your shopping cart"})]})})})})},R=function(e){var t=e.cartTotal;return Object(i.jsx)("div",{children:Object(i.jsx)("div",{className:"flex-shrink-0 px-6 py-4 flex justify-end border-t border-gray-200",children:Object(i.jsxs)("span",{children:["Total",Object(i.jsxs)("span",{className:"text-2xl px-4",children:[" $",Number(t).toFixed(2)]})]})})})},_=function(){var e=U(),t=e.page,n=e.setPage,c=e.listings,s=x(),a=B(),o=a.cartListings,l=a.addCartItem,u=a.removeCartItem,d=a.cartTotal;return console.log(s),Object(i.jsxs)(r.Fragment,{children:["anonymous"===s.status&&Object(i.jsx)("main",{className:"bg-gray-50 p-6 sm:p-12 min-h-screen",children:Object(i.jsx)("div",{className:"max-w-7xl mx-auto pt-16 pb-24 px-4 sm:px-6 lg:px-8",children:Object(i.jsx)(E,{})})}),"authenticated"===s.status&&Object(i.jsxs)("main",{className:"bg-gray-50 lg:flex",children:[Object(i.jsx)("div",{className:"flex-1",children:Object(i.jsxs)("div",{className:"max-w-7xl mx-auto pt-16 pb-24 px-4 sm:px-6 lg:px-8",children:[Object(i.jsx)("div",{className:"text-right",children:Object(i.jsx)(S,{})}),Object(i.jsx)("div",{className:"sm:flex sm:flex-col sm:align-center",children:Object(i.jsx)("h1",{className:"text-5xl font-extrabold text-gray-900 sm:text-center",children:"Marketplace"})}),Object(i.jsxs)("div",{className:"flex justify-between",children:[Object(i.jsx)(g,{type:"button",className:" bg-transparent  hover:bg-pink-600  text-pink-700  font-semibold  hover:text-white  py-2 px-10  border  border-pink-600  hover:border-transparent  rounded-2xl focus:ring-pink-900 m-2 ",disabled:1===t,onClick:function(){return n(t-1)},children:"Prev"}),Object(i.jsx)(g,{type:"button",className:" bg-transparent  hover:bg-pink-600  text-pink-700  font-semibold  hover:text-white  py-2 px-10  border  border-pink-600  hover:border-transparent  rounded-2xl focus:ring-pink-900 m-2 ",onClick:function(){return n(t+1)},children:"Next"})]}),Object(i.jsx)("div",{className:" grid md:grid-cols-2 gap-x-4 gap-y-8 xl:grid-cols-3 xl:gap-x-6 ",children:c&&c.map((function(e){return Object(i.jsx)(P,{imageUrl:e.imageUrl,title:e.title,description:e.description,price:e.price,availableStock:e.numOfStock,onlyOne:"single-item"===e.availability,onAddToCart:function(){return l(e._id,s)}},e._id)}))})]})}),Object(i.jsx)("div",{className:" flex-initial bg-white w-full lg:max-w-md border-b border-gray-100 ",children:Object(i.jsxs)("div",{className:"flex flex-col h-full",children:[Object(i.jsxs)("div",{className:"py-6 px-4 bg-pink-700 sm:px-6",children:[Object(i.jsx)("div",{className:"flex items-center justify-between",children:Object(i.jsx)("h2",{className:"text-lg font-medium text-white",children:"Your shopping cart"})}),Object(i.jsx)("div",{className:"mt-1",children:Object(i.jsx)("p",{className:"text-sm text-pink-300",children:"Listing added into your shopping cart"})})]}),o&&o.map((function(e){return Object(i.jsx)(G,{item:e,onClick:function(){return u(e.listing._id,s)}},e._id)})),0!==o.length&&Object(i.jsx)(R,{cartTotal:d}),0===o.length&&Object(i.jsx)(q,{})]})})]})]})};c.render(Object(i.jsx)(m,{children:Object(i.jsx)(_,{})}),document.querySelector("#root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.1dfea865.chunk.js.map